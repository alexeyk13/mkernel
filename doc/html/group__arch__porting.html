<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<title>M-Kernel: architecture porting</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">M-Kernel
   </div>
   <div id="projectbrief">EmbeddedRTOS</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.1.2 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="annotated.html"><span>Data&#160;Structures</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
</div><!-- top -->
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Data Structures</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Groups</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="summary">
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle">
<div class="title">architecture porting</div>  </div>
</div><!--header-->
<div class="contents">
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:ga1ef81c07fb54af9cb556e240b25c479e"><td class="memItemLeft" align="right" valign="top">unsigned int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__arch__porting.html#ga1ef81c07fb54af9cb556e240b25c479e">do_sys_call</a> (unsigned int num, unsigned int param1, unsigned int param2, unsigned int param3)</td></tr>
<tr class="memdesc:ga1ef81c07fb54af9cb556e240b25c479e"><td class="mdescLeft">&#160;</td><td class="mdescRight">arch-dependent context raiser  <a href="#ga1ef81c07fb54af9cb556e240b25c479e"></a><br/></td></tr>
<tr class="memitem:ga45badc3e8457d98796b5d8553c462f74"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__arch__porting.html#ga45badc3e8457d98796b5d8553c462f74">pend_switch_context</a> (void)</td></tr>
<tr class="memdesc:ga45badc3e8457d98796b5d8553c462f74"><td class="mdescLeft">&#160;</td><td class="mdescRight">pend switch context  <a href="#ga45badc3e8457d98796b5d8553c462f74"></a><br/></td></tr>
<tr class="memitem:ga78fb4d9546e268128a300160d77b347c"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__arch__porting.html#ga78fb4d9546e268128a300160d77b347c">thread_setup_context</a> (<a class="el" href="structTHREAD.html">THREAD</a> *thread, THREAD_FUNCTION fn, void *param)</td></tr>
<tr class="memdesc:ga78fb4d9546e268128a300160d77b347c"><td class="mdescLeft">&#160;</td><td class="mdescRight">setup initial context  <a href="#ga78fb4d9546e268128a300160d77b347c"></a><br/></td></tr>
<tr class="memitem:ga8e35cfd3a9d06b9246b8722985c16ebf"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__arch__porting.html#ga8e35cfd3a9d06b9246b8722985c16ebf">thread_patch_context</a> (<a class="el" href="structTHREAD.html">THREAD</a> *thread, unsigned int res)</td></tr>
<tr class="memdesc:ga8e35cfd3a9d06b9246b8722985c16ebf"><td class="mdescLeft">&#160;</td><td class="mdescRight">patch context  <a href="#ga8e35cfd3a9d06b9246b8722985c16ebf"></a><br/></td></tr>
</table>
<a name="details" id="details"></a><h2>Detailed Description</h2>
<p>For architecture support, all these functions must be implemented. Prototypes of hw-dependend functions. In most cases they are implemented in asm </p>
<h2>Function Documentation</h2>
<a class="anchor" id="ga1ef81c07fb54af9cb556e240b25c479e"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">unsigned int do_sys_call </td>
          <td>(</td>
          <td class="paramtype">unsigned int&#160;</td>
          <td class="paramname"><em>num</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned int&#160;</td>
          <td class="paramname"><em>param1</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned int&#160;</td>
          <td class="paramname"><em>param2</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned int&#160;</td>
          <td class="paramname"><em>param3</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>arch-dependent context raiser </p>
<p>If current contex is not enough during sys_call, context is raised, using this arch-specific function. After calling, return value is provided.</p>
<p>For example, for cortex-m3 "svc 0x12" instruction is used.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">num,:</td><td>sys-call number </td></tr>
    <tr><td class="paramname">param1,:</td><td>parameter 1. num-specific </td></tr>
    <tr><td class="paramname">param2,:</td><td>parameter 2. num-specific </td></tr>
    <tr><td class="paramname">param3,:</td><td>parameter 3. num-specific </td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">result</td><td>value. num-specific </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a class="anchor" id="ga45badc3e8457d98796b5d8553c462f74"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void pend_switch_context </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>pend switch context </p>
<p>Pends context switching and return immediatly.</p>
<p>On SVC/IRQ leaving, function implementation is called and do following:</p>
<ul>
<li>if (_active_thread) is not NULL, save current thread context on _active_thread stack</li>
<li>load current thread context from _next_thread stack</li>
<li>adjust stack pointer with _next_thread.cur_sp</li>
<li>move _next_thread - &gt; _active_thread, _next_thread = NULL <dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">none</td><td></td></tr>
  </table>
  </dd>
</dl>
</li>
</ul>

</div>
</div>
<a class="anchor" id="ga8e35cfd3a9d06b9246b8722985c16ebf"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void thread_patch_context </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structTHREAD.html">THREAD</a> *&#160;</td>
          <td class="paramname"><em>thread</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned int&#160;</td>
          <td class="paramname"><em>res</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>patch context </p>
<p>When any sync-object function is called, required waiting action, it will return with "true" result, however, caller thread will be put in "waiting" state. In case of timeouts, we need to patch stack, changing return value. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">thread,:</td><td>thread handle </td></tr>
    <tr><td class="paramname">res,:</td><td>return value to set </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a class="anchor" id="ga78fb4d9546e268128a300160d77b347c"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void thread_setup_context </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structTHREAD.html">THREAD</a> *&#160;</td>
          <td class="paramname"><em>thread</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">THREAD_FUNCTION&#160;</td>
          <td class="paramname"><em>fn</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>param</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>setup initial context </p>
<p>Just setup context. Real switching will be performed on pend_switch_context, when _next_thread == thread. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">thread,:</td><td>thread handle </td></tr>
    <tr><td class="paramname">fn,:</td><td>thread start point </td></tr>
    <tr><td class="paramname">param,:</td><td>thread parameter </td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">none</td><td></td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Wed Sep 12 2012 19:35:12 for M-Kernel by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.1.2
</small></address>
</body>
</html>
