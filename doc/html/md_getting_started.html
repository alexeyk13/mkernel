<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<title>M-Kernel: Getting started</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">M-Kernel
   </div>
   <div id="projectbrief">EmbeddedRTOS</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.1.2 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="annotated.html"><span>Data&#160;Structures</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Data Structures</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Groups</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">Getting started </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h1>Preparing project</h1>
<p>First of all, you need to copy shipped configuration files from template folder to your project working directory:</p>
<h2>kernel_config.h</h2>
<p>Is a main configuration file. Everything about hardware and kernel is configured here. It's recommended to keep here only kernel-specific configuration. Store project-specific configuration in own file - <a class="el" href="config_8h_source.html">config.h</a></p>
<p>kernel_config.h is highly sensitive for debug and profiling setting - more debug options you leave, more space compiled project will require.</p>
<p>first of all, make sure, following options are configured right:</p>
<p>#define SYS_TIMER_HPET TIM_4<br/>
<br/>
</p>
<p>#define SYS_TIMER_SOFT_RTC 0<br/>
 #define SYS_TIMER_RTC RTC_0<br/>
<br/>
</p>
<p>or:</p>
<p>#define SYS_TIMER_SOFT_RTC 1<br/>
 #define SYS_TIMER_SOFT_RTC_TIMER TIM_7<br/>
<br/>
</p>
<p>#define DBG_CONSOLE_BAUD 115200<br/>
 #define DBG_CONSOLE_UART UART_1<br/>
</p>
<h2>Makefile</h2>
<p>This file contains compilation rules for project and also defines global constants and target hardware.</p>
<p>Critical options are:</p>
<p><b>TARGET_NAME</b> - name of your project<br/>
 <b>KERNEL</b> - relative (recommended) or absolute path to M-Kernel files<br/>
</p>
<p><b>MCU_NAME</b> - name of target MCU. Supported MCU you can find inside /arch folder. Or you can add your own custom MCU. Refer to porting help.<br/>
 <b>EXT_OSCILLATOR_FREQ</b> - frequency in Hz of target crystall. If no external crystall is used, you need to set this value to 0<br/>
</p>
<p>STM32-specific:<br/>
</p>
<p><b>CMSIS_DIR</b> - path to CMSIS library<br/>
 <b>CMSIS_DEVICE</b> - uncomment one of CMSIS device class. For now, only STM32F2xx is supported<br/>
</p>
<h2>Hardware config</h2>
<p>It is hardware-dependent part of configuration. File name starts with hw_config_&lt;your architecture&gt;.h. For getting started it's enough to have this file in project</p>
<h1>Writing first kernel</h1>
<p>For start, you need only 2 functions to write.</p>
<h2>idle_task</h2>
<p>This task is running, while other tasks are sleeping. Because M-Kernel is tickless, there is no need to call system 100 times in second and you can use idle_task for wery good power saving.</p>
<p>For start, following code from example will be good enough</p>
<p>void <a class="el" href="group__user__provided.html#ga72b95d7bf14c8b40e3df1b5c0a647a29" title="user-provided idle task">idle_task(void)</a> { for (;;) {__WFI();} }</p>
<h2>application_init</h2>
<p>called after initial hardware is initialized and before interrupts are enabled. Initialize user hardware here (like gpio), initialize variables and create some tasks here. Look at main.c in example for more details.</p>
<p>That's all!</p>
<p>Everything rest will be done by M-Kernel, like:</p>
<ul>
<li>preparing stacks</li>
<li>preparing memory manager</li>
<li>setting up pll, core frequency</li>
<li>starting debug console</li>
<li>... and lots more </li>
</ul>
</div></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Wed Sep 12 2012 19:27:58 for M-Kernel by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.1.2
</small></address>
</body>
</html>
